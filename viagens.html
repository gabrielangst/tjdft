<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planejador de Viagens Colaborativo</title>
    <!-- Incluindo Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo a fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para a barra de rolagem */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease-in-out;
        }
        .trip-card-delete-button {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .trip-card:hover .trip-card-delete-button {
            opacity: 1;
        }
        .copy-btn {
            cursor: pointer;
            transition: background-color 0.2s;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Tela de Login (mostrada quando o usuário não está logado) -->
    <div id="login-view" class="flex items-center justify-center min-h-screen">
        <div class="text-center p-8 bg-white rounded-xl shadow-2xl max-w-sm w-full mx-4">
            <h1 class="text-3xl font-bold text-slate-900">Bem-vindo(a)</h1>
            <p class="text-slate-500 mt-2 mb-8">Faça login para acessar e sincronizar suas viagens em todos os seus dispositivos.</p>
            <button id="login-btn" class="w-full flex items-center justify-center gap-3 bg-white border border-slate-300 text-slate-700 font-semibold px-5 py-3 rounded-lg shadow-sm hover:bg-slate-50 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 48 48">
                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C44.577,34.237,48,27.461,48,20C48,17.432,47.669,14.962,47.08,12.599L43.611,20.083z"></path>
                </svg>
                <span>Entrar com Google</span>
            </button>
        </div>
    </div>
    
    <!-- Conteúdo Principal do App (mostrado após o login) -->
    <div id="app-content" class="max-w-7xl mx-auto p-4 md:p-8 hidden">
        <!-- Header com informações do usuário -->
        <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 border-b border-slate-200 pb-4 gap-4">
            <div>
                <p class="text-sm text-slate-600">Logado como: <strong id="user-name" class="font-semibold"></strong></p>
                <div class="text-xs text-slate-500 mt-1 flex items-center gap-2">
                    <span>Seu ID de Compartilhamento:</span>
                    <span id="user-uid" class="font-mono bg-slate-200 px-2 py-1 rounded"></span>
                    <button id="copy-uid-btn" title="Copiar ID" class="copy-btn p-1 rounded hover:bg-slate-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                    </button>
                </div>
            </div>
            <button id="logout-btn" class="text-sm font-medium text-blue-600 hover:text-blue-800 self-start sm:self-center">Sair</button>
        </div>
        
        <!-- Tela Principal: Lista de Viagens -->
        <div id="trips-view">
            <header class="flex flex-col sm:flex-row justify-between sm:items-center mb-8">
                <div>
                    <h1 class="text-4xl font-bold text-slate-900">Minhas Viagens</h1>
                    <p class="text-slate-500 mt-1">Planeje e organize suas próximas aventuras.</p>
                </div>
                <button onclick="openModal('add-trip-modal')" class="mt-4 sm:mt-0 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
                    <span>Nova Viagem</span>
                </button>
            </header>

            <main id="trips-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Os cards de viagem serão inseridos aqui pelo JavaScript -->
            </main>
        </div>

        <!-- Tela de Detalhes da Viagem (inicialmente oculta) -->
        <div id="details-view" class="hidden">
            <header class="mb-8">
                <button onclick="showTripsView()" class="flex items-center gap-2 text-slate-600 hover:text-slate-900 font-medium mb-4 transition-colors">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    Voltar para todas as viagens
                </button>
                <h1 id="details-title" class="text-4xl font-bold text-slate-900"></h1>
                <p id="details-dates" class="text-slate-500 mt-1"></p>
                <div class="flex items-center gap-2 mt-4 flex-wrap">
                    <button onclick="openModal('edit-image-modal')" class="flex items-center gap-2 text-sm bg-slate-200 text-slate-700 font-semibold px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                        <span>Alterar Imagem</span>
                    </button>
                    <button onclick="openModal('edit-trip-modal')" class="flex items-center gap-2 text-sm bg-slate-200 text-slate-700 font-semibold px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                        <span>Editar Viagem</span>
                    </button>
                    <button onclick="openModal('share-trip-modal')" class="flex items-center gap-2 text-sm bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
                        <span>Compartilhar</span>
                    </button>
                </div>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Seção de Voos -->
                <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold">Voos</h2>
                        <button onclick="openModal('add-flight-modal')" class="flex items-center justify-center w-10 h-10 bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="flights-list" class="space-y-4"></div>
                </section>
                <!-- Seção de Trens -->
                <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold">Trens</h2>
                        <button onclick="openModal('add-train-modal')" class="flex items-center justify-center w-10 h-10 bg-green-100 text-green-600 rounded-full hover:bg-green-200 transition-colors">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="trains-list" class="space-y-4"></div>
                </section>
                <!-- Seção de Hospedagens -->
                <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold">Hospedagens</h2>
                        <button onclick="openModal('add-lodging-modal')" class="flex items-center justify-center w-10 h-10 bg-purple-100 text-purple-600 rounded-full hover:bg-purple-200 transition-colors">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="lodging-list" class="space-y-4"></div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modais (inicialmente ocultos) -->
    <!-- Modal: Adicionar Viagem -->
    <div id="add-trip-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Adicionar Nova Viagem</h3>
            <form id="add-trip-form" class="space-y-4">
                <div>
                    <label for="trip-name" class="block text-sm font-medium text-slate-600">Nome da Viagem</label>
                    <input type="text" id="trip-name" placeholder="Ex: Férias na Itália" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="trip-destination" class="block text-sm font-medium text-slate-600">Destino</label>
                    <input type="text" id="trip-destination" placeholder="Ex: Roma, Florença, Veneza" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <label for="trip-start-date" class="block text-sm font-medium text-slate-600">Data de Início</label>
                        <input type="date" id="trip-start-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div class="flex-1">
                        <label for="trip-end-date" class="block text-sm font-medium text-slate-600">Data de Fim</label>
                        <input type="date" id="trip-end-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('add-trip-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-semibold">Salvar Viagem</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal: Adicionar Voo -->
     <div id="add-flight-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Adicionar Voo</h3>
            <form id="add-flight-form" class="space-y-4">
                 <div>
                    <label class="block text-sm font-medium text-slate-600">Companhia Aérea</label>
                    <input type="text" id="flight-company" placeholder="Ex: Azul" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600">Código do Voo</label>
                    <input type="text" id="flight-code" placeholder="Ex: AD4321" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('add-flight-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-semibold">Adicionar Voo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Trem -->
     <div id="add-train-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Adicionar Trem</h3>
            <form id="add-train-form" class="space-y-4">
                 <div>
                    <label class="block text-sm font-medium text-slate-600">Origem</label>
                    <input type="text" id="train-origin" placeholder="Ex: Roma Termini" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600">Destino</label>
                    <input type="text" id="train-destination" placeholder="Ex: Firenze S.M.N." class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('add-train-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors font-semibold">Adicionar Trem</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Hospedagem -->
     <div id="add-lodging-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Adicionar Hospedagem</h3>
            <form id="add-lodging-form" class="space-y-4">
                 <div>
                    <label class="block text-sm font-medium text-slate-600">Nome do Hotel/Local</label>
                    <input type="text" id="lodging-name" placeholder="Ex: Hotel Coliseu" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600">Endereço</label>
                    <input type="text" id="lodging-address" placeholder="Ex: Via Cavour, 123" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('add-lodging-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors font-semibold">Adicionar Hospedagem</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Alterar Imagem -->
     <div id="edit-image-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Alterar Imagem da Viagem</h3>
            <form id="edit-image-form" class="space-y-4">
                 <div>
                    <label for="trip-image-url" class="block text-sm font-medium text-slate-600">URL da Nova Imagem</label>
                    <input type="url" id="trip-image-url" placeholder="https://exemplo.com/imagem.jpg" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('edit-image-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-semibold">Salvar Imagem</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Editar Viagem -->
    <div id="edit-trip-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Editar Informações da Viagem</h3>
            <form id="edit-trip-form" class="space-y-4">
                <div>
                    <label for="edit-trip-name" class="block text-sm font-medium text-slate-600">Nome da Viagem</label>
                    <input type="text" id="edit-trip-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm" required>
                </div>
                <div>
                    <label for="edit-trip-destination" class="block text-sm font-medium text-slate-600">Destino</label>
                    <input type="text" id="edit-trip-destination" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm" required>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex-1">
                        <label for="edit-trip-start-date" class="block text-sm font-medium text-slate-600">Data de Início</label>
                        <input type="date" id="edit-trip-start-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm" required>
                    </div>
                    <div class="flex-1">
                        <label for="edit-trip-end-date" class="block text-sm font-medium text-slate-600">Data de Fim</label>
                        <input type="date" id="edit-trip-end-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm" required>
                    </div>
                </div>
                <div class="pt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeModal('edit-trip-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-semibold">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Compartilhar Viagem -->
    <div id="share-trip-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md m-4">
            <h3 class="text-2xl font-semibold mb-6">Compartilhar Viagem</h3>
            <form id="share-trip-form" class="flex items-center gap-2 mb-6">
                <input type="text" id="share-uid-input" placeholder="Cole o ID de Compartilhamento do seu amigo" class="flex-grow px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors font-semibold">Adicionar</button>
            </form>
            <h4 class="text-lg font-semibold mb-3">Membros da Viagem</h4>
            <div id="members-list" class="space-y-2 max-h-48 overflow-y-auto">
                <!-- Lista de membros será preenchida aqui -->
            </div>
            <div class="pt-6 flex justify-end">
                <button type="button" onclick="closeModal('share-trip-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmação de Exclusão -->
    <div id="confirm-delete-modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-backdrop">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-sm m-4">
            <h3 class="text-xl font-semibold mb-4">Confirmar Exclusão</h3>
            <p id="confirm-delete-message" class="text-slate-600 mb-6">Você tem certeza que deseja excluir este item?</p>
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeModal('confirm-delete-modal')" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition-colors">Cancelar</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-semibold">Excluir</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set, push, remove, update, off, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // --- INÍCIO DA CONFIGURAÇÃO DO FIREBASE ---
        const firebaseConfigManual = {
            apiKey: "AIzaSyBq4B9LCCat5jof2x9g5KN16UCOgnYo364",
            authDomain: "viagensapp-75077.firebaseapp.com",
            projectId: "viagensapp-75077",
            storageBucket: "viagensapp-75077.appspot.com",
            messagingSenderId: "231052282749",
            appId: "1:231052282749:web:2cd3cca2d77d4112dd1a14",
            databaseURL: "https://viagensapp-75077-default-rtdb.firebaseio.com"
        };
        // --- FIM DA CONFIGURAÇÃO DO FIREBASE ---

        // Variáveis globais
        let db, auth, userId;
        let tripsData = []; 
        let currentTripId = null;
        let onConfirmAction = () => {};
        let tripListeners = {}; // Armazena os listeners ativos para cada viagem

        // Configuração e inicialização do Firebase
        const firebaseConfig = (typeof __firebase_config !== 'undefined' && __firebase_config)
                                ? JSON.parse(__firebase_config)
                                : firebaseConfigManual;

        if (firebaseConfig && firebaseConfig.apiKey !== "COLE_SUA_API_KEY_AQUI") {
            try {
                const app = initializeApp(firebaseConfig);
                db = getDatabase(app);
                auth = getAuth(app);

                const loginView = document.getElementById('login-view');
                const appContent = document.getElementById('app-content');
                const userNameEl = document.getElementById('user-name');
                const userUidEl = document.getElementById('user-uid');
                const loginBtn = document.getElementById('login-btn');
                const logoutBtn = document.getElementById('logout-btn');
                const copyUidBtn = document.getElementById('copy-uid-btn');

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // Usuário está logado
                        userId = user.uid;
                        console.log("User authenticated with UID:", userId);
                        
                        userNameEl.textContent = user.displayName || user.email;
                        userUidEl.textContent = userId;
                        loginView.classList.add('hidden');
                        appContent.classList.remove('hidden');
                        
                        setupTripsListener();
                    } else {
                        // Usuário não está logado
                        console.log("No user signed in.");
                        userId = null;
                        detachAllTripListeners();
                        tripsData = [];
                        renderApp(); 
                        
                        appContent.classList.add('hidden');
                        loginView.classList.remove('hidden');
                    }
                });

                // Funções de Autenticação
                const loginWithGoogle = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(err => console.error("Login failed:", err));
                const logout = () => signOut(auth).catch(err => console.error("Logout failed:", err));
                
                loginBtn.addEventListener('click', loginWithGoogle);
                logoutBtn.addEventListener('click', logout);
                copyUidBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(userId).then(() => {
                        const originalText = copyUidBtn.innerHTML;
                        copyUidBtn.innerHTML = 'Copiado!';
                        setTimeout(() => { copyUidBtn.innerHTML = originalText; }, 2000);
                    });
                });

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                document.body.innerHTML = `<p class="text-center text-red-500 p-8">Erro ao conectar ao Firebase.</p>`;
            }
        } else {
            console.error("Firebase config is not available.");
            document.body.innerHTML = `<p class="text-center text-red-500 p-8">Configuração do Firebase não encontrada.</p>`;
        }
        
        // --- FUNÇÕES DE RENDERIZAÇÃO E ESTADO ---
        
        function renderApp() {
            if (document.getElementById('details-view').classList.contains('hidden')) {
                renderTrips();
            } else if(currentTripId) {
                renderTripDetails(currentTripId);
            }
        }

        function renderTrips() {
            const tripsList = document.getElementById('trips-list');
            tripsList.innerHTML = ''; 

            if (tripsData.length === 0) {
                 tripsList.innerHTML = `<div class="col-span-full text-center p-10 bg-white rounded-lg shadow-sm">
                    <h3 class="text-xl font-medium text-slate-700">Nenhuma viagem encontrada.</h3>
                    <p class="text-slate-500 mt-2">Crie uma nova viagem ou peça para um amigo compartilhar uma com você!</p>
                </div>`;
                return;
            }

            tripsData.sort((a, b) => a.name.localeCompare(b.name)).forEach(trip => {
                const tripCard = document.createElement('div');
                tripCard.className = 'trip-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer transform hover:-translate-y-1 transition-transform duration-300 relative';
                tripCard.onclick = () => showTripDetails(trip.id);
                
                // Botão de deletar só aparece para o dono da viagem
                const deleteBtnHtml = trip.owner === userId ? `
                    <button onclick="deleteTrip(event, '${trip.id}')" class="trip-card-delete-button absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                    </button>` : '';

                tripCard.innerHTML = `
                    ${deleteBtnHtml}
                    <div class="h-48 bg-cover bg-center" style="background-image: url('${trip.imageUrl}')"></div>
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-slate-900">${trip.name}</h3>
                        <p class="text-slate-500 mt-1">${trip.destination}</p>
                        <div class="mt-4 text-sm font-medium text-slate-600">
                           ${formatDate(trip.startDate)} - ${formatDate(trip.endDate)}
                        </div>
                    </div>
                `;
                tripsList.appendChild(tripCard);
            });
        }
        
        function renderTripDetails(tripId) {
            const trip = tripsData.find(t => t.id === tripId);
            if (!trip) {
                showTripsView();
                return;
            }
            
            currentTripId = trip.id;
            document.getElementById('details-title').innerText = trip.name;
            document.getElementById('details-dates').innerText = `${formatDate(trip.startDate)} a ${formatDate(trip.endDate)}`;

            renderDetailList('flights-list', trip.flights, (item, index) => `
                <div><p class="font-bold">${item.company} - ${item.code}</p></div>
                <button onclick="deleteDetailItem('flights', ${index})" class="text-red-500 hover:text-red-700">&times;</button>
            `, 'Nenhum voo adicionado.');

            renderDetailList('trains-list', trip.trains, (item, index) => `
                <div><p class="font-bold">${item.from} → ${item.to}</p></div>
                <button onclick="deleteDetailItem('trains', ${index})" class="text-red-500 hover:text-red-700">&times;</button>
            `, 'Nenhum trem adicionado.');
            
            renderDetailList('lodging-list', trip.lodging, (item, index) => `
                <div><p class="font-bold">${item.name}</p><p class="text-sm text-slate-500">${item.address}</p></div>
                <button onclick="deleteDetailItem('lodging', ${index})" class="text-red-500 hover:text-red-700">&times;</button>
            `, 'Nenhuma hospedagem adicionada.');
            
            renderMembersList(trip);
        }
        
        async function renderMembersList(trip) {
            const membersListEl = document.getElementById('members-list');
            membersListEl.innerHTML = '<p class="text-slate-500">Carregando membros...</p>';
            if (!trip || !trip.members) return;

            const memberIds = Object.keys(trip.members);
            // Simulação para buscar nomes de usuários (em um app real, teria uma coleção 'users')
            const membersHtml = memberIds.map(memberId => {
                const isOwner = memberId === trip.owner;
                const removeBtnHtml = !isOwner && trip.owner === userId ? `<button type="button" onclick="removeMember('${memberId}')" class="text-xs text-red-500 hover:underline">Remover</button>` : '';
                return `
                    <div class="flex justify-between items-center bg-slate-100 p-2 rounded">
                        <span class="text-sm">${memberId === userId ? 'Você' : memberId.substring(0, 12)}... ${isOwner ? '<span class="text-xs font-semibold text-amber-600">(Dono)</span>' : ''}</span>
                        ${removeBtnHtml}
                    </div>
                `;
            }).join('');
            
            membersListEl.innerHTML = membersHtml || '<p class="text-slate-500">Apenas você.</p>';
        }

        function renderDetailList(elementId, items, itemTemplate, emptyMessage) {
            const listElement = document.getElementById(elementId);
            listElement.innerHTML = '';
            const itemsArray = items ? Object.values(items) : [];
            if (itemsArray.length === 0) {
                listElement.innerHTML = `<p class="text-slate-500 text-sm">${emptyMessage}</p>`;
                return;
            }
            itemsArray.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex justify-between items-center border-l-4 border-slate-200 pl-4 py-2';
                itemDiv.innerHTML = itemTemplate(item, index);
                listElement.appendChild(itemDiv);
            });
        }
        
        // --- CONTROLE DE NAVEGAÇÃO E MODAIS ---
        window.showTripsView = () => {
            document.getElementById('trips-view').classList.remove('hidden');
            document.getElementById('details-view').classList.add('hidden');
            currentTripId = null;
            renderTrips(); // Garante que a lista está atualizada
        }

        window.showTripDetails = (tripId) => {
            renderTripDetails(tripId);
            document.getElementById('trips-view').classList.add('hidden');
            document.getElementById('details-view').classList.remove('hidden');
        }

        window.openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modalId === 'edit-image-modal' && currentTripId) {
                const trip = tripsData.find(t => t.id === currentTripId);
                if (trip) {
                    const imageUrlInput = document.getElementById('trip-image-url');
                    imageUrlInput.value = (trip.imageUrl && !trip.imageUrl.startsWith('https://placehold.co')) ? trip.imageUrl : '';
                }
            } else if (modalId === 'edit-trip-modal' && currentTripId) {
                const trip = tripsData.find(t => t.id === currentTripId);
                if (trip) {
                    document.getElementById('edit-trip-name').value = trip.name;
                    document.getElementById('edit-trip-destination').value = trip.destination;
                    document.getElementById('edit-trip-start-date').value = trip.startDate;
                    document.getElementById('edit-trip-end-date').value = trip.endDate;
                }
            }
            modal.classList.replace('hidden', 'flex');
        }

        window.closeModal = (modalId) => {
            document.getElementById(modalId).classList.replace('flex', 'hidden');
            const form = document.getElementById(modalId).querySelector('form');
            if (form) form.reset();
            if (modalId === 'confirm-delete-modal') {
                onConfirmAction = () => {};
            }
        }
        
        // --- LÓGICA DO BANCO DE DADOS (REALTIME DATABASE) ---

        let userTripsRefListener = null;

        function detachAllTripListeners() {
            if (userTripsRefListener) {
                off(userTripsRefListener);
                userTripsRefListener = null;
            }
            Object.values(tripListeners).forEach(listenerRef => off(listenerRef));
            tripListeners = {};
        }

        function setupTripsListener() {
            if (!userId) return;
            detachAllTripListeners(); // Limpa listeners antigos antes de criar novos

            const userTripsRef = ref(db, `userTrips/${userId}`);
            userTripsRefListener = onValue(userTripsRef, (snapshot) => {
                const tripIds = snapshot.val() || {};

                // Remove da UI as viagens que não pertencem mais ao usuário
                tripsData = tripsData.filter(trip => tripIds[trip.id]);

                // Desvincula listeners de viagens removidas
                Object.keys(tripListeners).forEach(tripId => {
                    if (!tripIds[tripId]) {
                        off(tripListeners[tripId]);
                        delete tripListeners[tripId];
                    }
                });

                // Adiciona listeners para novas viagens
                Object.keys(tripIds).forEach(tripId => {
                    if (!tripListeners[tripId]) {
                        const tripRef = ref(db, `trips/${tripId}`);
                        tripListeners[tripId] = onValue(tripRef, (tripSnap) => {
                            if (tripSnap.exists()) {
                                const tripData = { id: tripId, ...tripSnap.val() };
                                const index = tripsData.findIndex(t => t.id === tripId);
                                if (index > -1) {
                                    tripsData[index] = tripData; // Atualiza
                                } else {
                                    tripsData.push(tripData); // Adiciona
                                }
                            } else {
                                // Se a viagem foi deletada, remove localmente
                                tripsData = tripsData.filter(t => t.id !== tripId);
                            }
                            renderApp();
                        });
                    }
                });

                if (Object.keys(tripIds).length === 0) {
                    tripsData = [];
                    renderApp();
                }
            });
        }
        
        // AÇÕES (CRUD + Share)
        
        document.getElementById('add-trip-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const tripName = document.getElementById('trip-name').value;
            const newTripData = {
                name: tripName,
                destination: document.getElementById('trip-destination').value,
                startDate: document.getElementById('trip-start-date').value,
                endDate: document.getElementById('trip-end-date').value,
                imageUrl: `https://placehold.co/600x400/a3e635/1e293b?text=${encodeURIComponent(tripName)}`,
                owner: userId,
                members: { [userId]: true }
            };

            const newTripRef = push(ref(db, 'trips'));
            const newTripKey = newTripRef.key;

            const updates = {};
            updates[`/trips/${newTripKey}`] = newTripData;
            updates[`/userTrips/${userId}/${newTripKey}`] = true;

            await update(ref(db), updates);
            closeModal('add-trip-modal');
        });
        
        window.deleteTrip = async (event, tripId) => {
            event.stopPropagation();
            const trip = tripsData.find(t => t.id === tripId);
            if (!trip || trip.owner !== userId) {
                alert("Apenas o dono pode excluir a viagem.");
                return;
            }
            
            showConfirmDelete('Tem certeza que deseja excluir esta viagem para TODOS os membros?', async () => {
                const updates = {};
                updates[`/trips/${tripId}`] = null; // Deleta a viagem principal
                if(trip.members){
                    Object.keys(trip.members).forEach(memberId => {
                        updates[`/userTrips/${memberId}/${tripId}`] = null; // Remove a referência para cada membro
                    });
                }
                await update(ref(db), updates);
                closeModal('confirm-delete-modal');
                showTripsView();
            });
        }

        async function addDetail(category) {
            if (!currentTripId) return;
            let newItem = {};
            if (category === 'flights') {
                newItem = { company: document.getElementById('flight-company').value, code: document.getElementById('flight-code').value };
            } else if (category === 'trains') {
                newItem = { from: document.getElementById('train-origin').value, to: document.getElementById('train-destination').value };
            } else if (category === 'lodging') {
                newItem = { name: document.getElementById('lodging-name').value, address: document.getElementById('lodging-address').value };
            }
            
            const detailRef = ref(db, `trips/${currentTripId}/${category}`);
            const newDetailRef = push(detailRef);
            await set(newDetailRef, newItem);

            closeModal(`add-${category === 'lodging' ? 'lodging' : category.slice(0, -1)}-modal`);
        }

        window.deleteDetailItem = async (category, itemKey) => {
             // Esta função precisa ser adaptada pois o RTDB agora usa chaves únicas, não índices
             console.log("Deletar item ainda não implementado com chaves únicas.");
        }
        
        document.getElementById('add-flight-form').addEventListener

